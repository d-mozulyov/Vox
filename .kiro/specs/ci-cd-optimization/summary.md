# –°–≤–æ–¥–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ CI/CD

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. Docker –æ–±—Ä–∞–∑ –¥–ª—è —Å–±–æ—Ä–∫–∏

**–°–æ–∑–¥–∞–Ω–æ:**
- `docker/builder/Dockerfile` - –æ–±—Ä–∞–∑ —Å–æ –≤—Å–µ–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- `docker/builder/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–±—Ä–∞–∑—É
- `docker/builder/.dockerignore` - –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ–±—Ä–∞–∑–∞:**
- Go 1.21.6
- musl-tools –∏ musl-dev
- aarch64-linux-musl-cross –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä
- –í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ Linux –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- Xvfb –¥–ª—è headless —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ:** `ghcr.io/d-mozulyov/vox-builder:latest`

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ GitHub Actions workflows

**–û–±–Ω–æ–≤–ª–µ–Ω–æ `.github/workflows/build.yml`:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–º–µ—Å—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Go –º–æ–¥—É–ª–µ–π –∏ —Å–±–æ—Ä–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—Ä–∞–∑–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `BUILDER_IMAGE`
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–æ–≤

**–°–æ–∑–¥–∞–Ω–æ `.github/workflows/docker-build.yml`:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Dockerfile
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ GitHub UI
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ GitHub Container Registry

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–°–æ–∑–¥–∞–Ω–æ:**
- `docs/DOCKER_BUILD.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ Docker –æ–±—Ä–∞–∑—É
  - –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
  - –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π –æ–±—Ä–∞–∑ –¥–ª—è —Ñ–æ—Ä–∫–∞
  - –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
  - Troubleshooting

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:**
- `BUILD.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Docker –æ–±—Ä–∞–∑–µ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–∏
- `README.md` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ Docker –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- `docker/builder/README.md` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

**–î–ª—è –∫–æ–º–∞–Ω–¥—ã (–≤ `.kiro/specs/ci-cd-optimization/`):**
- `requirements.md` - —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `design.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
- `tasks.md` - —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å –æ—Ç–º–µ—Ç–∫–∞–º–∏ –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
- `next-steps.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤
- `summary.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

### 4. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ workflow —Ñ–∞–π–ª–∞—Ö

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤:
- `.github/workflows/build.yml` - –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–±—Ä–∞–∑
- `.github/workflows/docker-build.yml` - –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å –æ–±—Ä–∞–∑

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: ~5-7 –º–∏–Ω—É—Ç
- –¢–µ—Å—Ç—ã: ~1-2 –º–∏–Ω—É—Ç—ã
- –°–±–æ—Ä–∫–∞: ~3-5 –º–∏–Ω—É—Ç
- **–ò—Ç–æ–≥–æ: ~10-15 –º–∏–Ω—É—Ç**

**–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Pull Docker –æ–±—Ä–∞–∑–∞: ~10-20 —Å–µ–∫—É–Ω–¥
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–µ—à–∞: ~5-10 —Å–µ–∫—É–Ω–¥
- –¢–µ—Å—Ç—ã: ~1-2 –º–∏–Ω—É—Ç—ã (—Å –∫–µ—à–µ–º –±—ã—Å—Ç—Ä–µ–µ)
- –°–±–æ—Ä–∫–∞: ~2-3 –º–∏–Ω—É—Ç—ã (—Å –∫–µ—à–µ–º –±—ã—Å—Ç—Ä–µ–µ)
- **–ò—Ç–æ–≥–æ: ~3-5 –º–∏–Ω—É—Ç**

**–£—Å–∫–æ—Ä–µ–Ω–∏–µ: –≤ 3-4 —Ä–∞–∑–∞** üöÄ

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úì –ë—ã—Å—Ç—Ä—ã–µ —Å–±–æ—Ä–∫–∏  
‚úì –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ  
‚úì –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å (–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç apt-get)  
‚úì –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Go –º–æ–¥—É–ª–µ–π  
‚úì –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–æ–≤  
‚úì –ì–∏–±–∫–æ—Å—Ç—å –¥–ª—è —Ñ–æ—Ä–∫–æ–≤  

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

1. –ü—Ä–∏ push –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è workflow
2. GitHub Actions —Å–∫–∞—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞–∑ `ghcr.io/d-mozulyov/vox-builder:latest`
3. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∫–µ—à Go (–µ—Å–ª–∏ –µ—Å—Ç—å)
4. –ó–∞–ø—É—Å–∫–∞—é—Ç—Å—è —Ç–µ—Å—Ç—ã –∏ —Å–±–æ—Ä–∫–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è

### –î–ª—è —Ñ–æ—Ä–∫–æ–≤

**–í–∞—Ä–∏–∞–Ω—Ç 1 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ `ghcr.io/d-mozulyov/vox-builder:latest`
- –ù–∏—á–µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ

**–í–∞—Ä–∏–∞–Ω—Ç 2 (–∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è):**
1. –ò–∑–º–µ–Ω–∏—Ç—å `docker/builder/Dockerfile` –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å workflow "Build Docker Image" –≤ —Å–≤–æ—ë–º —Ñ–æ—Ä–∫–µ
3. –û–±—Ä–∞–∑ –æ–ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ `ghcr.io/YOUR_USERNAME/vox-builder:latest`
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `BUILDER_IMAGE` –≤ Settings ‚Üí Variables
5. Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–∞—à –æ–±—Ä–∞–∑

## –§–∞–π–ª—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å Docker

```
.github/workflows/
  ‚îú‚îÄ‚îÄ build.yml              # –û—Å–Ω–æ–≤–Ω–æ–π CI/CD (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—Ä–∞–∑)
  ‚îî‚îÄ‚îÄ docker-build.yml       # –°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞

docker/builder/
  ‚îú‚îÄ‚îÄ Dockerfile             # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞
  ‚îú‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–±—Ä–∞–∑—É
  ‚îî‚îÄ‚îÄ .dockerignore          # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è —Å–±–æ—Ä–∫–∏

docs/
  ‚îî‚îÄ‚îÄ DOCKER_BUILD.md        # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

.kiro/specs/ci-cd-optimization/
  ‚îú‚îÄ‚îÄ requirements.md        # –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
  ‚îú‚îÄ‚îÄ design.md              # –î–∏–∑–∞–π–Ω —Ä–µ—à–µ–Ω–∏—è
  ‚îú‚îÄ‚îÄ tasks.md               # –ó–∞–¥–∞—á–∏
  ‚îú‚îÄ‚îÄ next-steps.md          # –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏
  ‚îî‚îÄ‚îÄ summary.md             # –≠—Ç–∞ —Å–≤–æ–¥–∫–∞
```

## –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å Go, –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

1. –ò–∑–º–µ–Ω–∏—Ç—å `docker/builder/Dockerfile`
2. –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å
3. Workflow –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç –æ–±—Ä–∞–∑
4. –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é: Actions ‚Üí Build Docker Image ‚Üí Run workflow

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ –æ–±—Ä–∞–∑ –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
# –°–±–æ—Ä–∫–∞
docker run --rm -v $(pwd):/workspace ghcr.io/d-mozulyov/vox-builder:latest \
  go build -o vox ./cmd/vox

# –¢–µ—Å—Ç—ã
docker run --rm -v $(pwd):/workspace ghcr.io/d-mozulyov/vox-builder:latest \
  bash -c "Xvfb :99 -screen 0 1024x768x24 > /dev/null 2>&1 & export DISPLAY=:99.0 && sleep 1 && go test ./..."
```

## –î–ª—è –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä–æ–≤

–ï—Å–ª–∏ –≤—ã –¥–µ–ª–∞–µ—Ç–µ PR:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–∏—á–µ–≥–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
- CI/CD —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ

–ï—Å–ª–∏ –≤—ã —Ñ–æ—Ä–∫–∞–µ—Ç–µ –ø—Ä–æ–µ–∫—Ç:
- –°–º. `docs/DOCKER_BUILD.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
- –ú–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Docker –æ–±—Ä–∞–∑ –ø—É–±–ª–∏—á–Ω—ã–π (–Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤)
- PAT –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–∞ (–Ω–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- GitHub Actions –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `GITHUB_TOKEN`
- –û–±—Ä–∞–∑ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å: `docker pull ghcr.io/d-mozulyov/vox-builder:latest`

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úì Docker –æ–±—Ä–∞–∑ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω
2. ‚úì –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
3. ‚úì Workflows –æ–±–Ω–æ–≤–ª–µ–Ω—ã
4. ‚Üí –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
5. ‚Üí –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É CI/CD
6. ‚Üí –ó–∞–º–µ—Ä–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## –°—Å—ã–ª–∫–∏

- –û–±—Ä–∞–∑: https://github.com/d-mozulyov/vox-builder/pkgs/container/vox-builder
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [docs/DOCKER_BUILD.md](../../../docs/DOCKER_BUILD.md)
- Workflow: [.github/workflows/build.yml](../../../.github/workflows/build.yml)
- Docker build: [.github/workflows/docker-build.yml](../../../.github/workflows/docker-build.yml)
